<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Chat</title>
</head>
<body>
    <h1>Local Network Chat</h1>
    <div>
        <input id="message" type="text" placeholder="Enter your message" />
        <select id="target">
            <option value="ALL">ALL</option>
        </select>
        <button id="send">Send</button>
    </div>
    <h2>Messages</h2>
    <ul id="messages"></ul>

    <script>
        const socket = new WebSocket(`ws://${window.location.hostname}:8080/ws`);

        socket.onopen = () => {
            console.log("Connected to the server");
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);

            if (data.type === "device_list") {
                const target = document.getElementById("target");
                target.innerHTML = '<option value="ALL">ALL</option>';
                data.devices.forEach((device) => {
                    const option = document.createElement("option");
                    option.value = device;
                    option.textContent = device;
                    target.appendChild(option);
                });
            } else if (data.from) {
                const messages = document.getElementById("messages");
                const li = document.createElement("li");
                li.textContent = `${data.from} to ${data.to}: ${data.content}`;
                messages.appendChild(li);
            }
        };

        socket.onclose = () => {
            console.log("Disconnected from the server");
        };

        document.getElementById("send").addEventListener("click", () => {
            const message = document.getElementById("message").value;
            const target = document.getElementById("target").value;
            socket.send(JSON.stringify({ from: "ME", to: target, content: message }));
            document.getElementById("message").value = "";
        });

        function displayMessage(message) {
        const messagesDiv = document.getElementById("messages");
        const messageElement = document.createElement("div");
        messageElement.classList.add("message");

        const sender = message.from === deviceName ? "You" : message.from;
        const receiver = message.to === "ALL" ? "Everyone" : message.to;

        messageElement.innerHTML = `<strong>${sender} to ${receiver}:</strong> ${message.content}`;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll to latest message
    }
    </script>
</body>
</html>
